#!/usr/bin/env bash

set -e

DEBUG=${DEBUG:-''}
[ -n "${DEBUG}" ] && set -x

# set SCRIPT_PATH
SCRIPT_PATH="$(cd $(dirname "$0")/$(dirname "$(readlink "$0")") && pwd)"

CRONNAME=${1:-''}

[ -z "${CRONNAME}" ] && echo "ERROR: No \$CRONNAME given" && exit 1;

MAILTO="julian.gieseke@gmail.com"

LOGFILE="${SCRIPT_PATH}/bkp.${CRONNAME}.log"
[ ! -f "${LOGFILE}" ] && touch ${LOGFILE}

# ${SCRIPT_PATH}/bkp.${CRONNAME} | tee -a ${LOGFILE} 1>/dev/null

${SCRIPT_PATH}/bkp.${CRONNAME} 1>>${LOGFILE} 2>>${LOGFILE} \
  || echo -e "Subject: ‚ùå Error on Job '${CRONNAME}'\n\n$(tail $LOGFILE)" | ssmtp ${MAILTO} \
  || tail -n 100 $LOGFILE
