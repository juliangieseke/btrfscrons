#!/usr/bin/env bash

# example: 
# /mnt/.bkp/bin/snapshot-cleanup /mnt/data.disk/datenteich.snapshots

set -e

DEBUG=${DEBUG:-''}
[ -n "${DEBUG}" ] && set -x

base_path="$(cd $(dirname "$0")/$(dirname "$(readlink "$0")") && cd .. && pwd)"
dst_path=${1:-''}
jobtype=${2:-'hourly'}
keepdays=${3:-'999'}

find "${dst_path%/}/" -maxdepth 1 -type d -name "*${jobtype}*" -ctime +${keepdays} -exec ${base_path}/bin/snapshot-delete '{}' \;
